<!-- Modal de edicao -->
<div class="modal fade" id="ModalChange" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">Atualizar Transação</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editForm" method="POST">
                    <input type="hidden" id="transactionId">

                    <div class="mb-3">
                        <label for="description" class="form-label">Descrição</label>
                        <input type="text" class="form-control" id="description">
                    </div>

                    <div class="mb-3" hidden="false">
                        <label for="category_id" class="form-label">ID da Categoria</label>
                        <input class="form-control" id="category_id" disabled>
                    </div>

                    <div class="mb-3">
                        <label for="category_name" class="form-label">Nome da Categoria</label>
                        <select name="category_select" id="category_name" class="form-select">
                            {% for categorie in categories %}
                            <option>
                                {{ categorie.category }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3" hidden="false">
                        <label for="account_id" class="form-label">ID da Conta</label>
                        <input type="text" class="form-control" id="account_id" disabled>
                    </div>

                    <div class="mb-3">
                        <label for="account_name" class="form-label">Nome da Conta</label>
                        <select name="account_select" id="account_name" class="form-select">
                            {% for account in accounts %}
                            <option>
                                {{ account.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="account_name" class="form-label">Data de Vencimento</label>
                        <input type="date" class="form-control" id="due_date">
                    </div>

                    <div class="mb-3">
                        <label for="value" class="form-label">Valor</label>
                        <input type="number" step="0.01" class="form-control" id="value">
                    </div>

                    <div class="mb-3" hidden="false">
                        <label for="created_at" class="form-label">Data</label>
                        <input type="date" class="form-control" id="created_at" disabled>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" id="saveChanges">Salvar</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll("#edit-btn").forEach(button => {
            button.addEventListener("click", function () {
                const transactionId = this.getAttribute("data-id");

                fetch(`/transactions/${transactionId}/update/`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("transactionId").value = data.id;
                        document.getElementById("description").value = data.description;
                        document.getElementById("category_id").value = data.category_id;
                        document.getElementById("category_name").value = data.category_name;
                        document.getElementById("due_date").value = data.due_date;
                        document.getElementById("account_id").value = data.account_id;
                        document.getElementById("account_name").value = data.account_name;
                        document.getElementById("value").value = data.value;
                        document.getElementById("created_at").value = data.created_at;

                        new bootstrap.Modal(document.getElementById("ModalChange")).show();
                    });
            });
        });

        document.getElementById("saveChanges").addEventListener("click", function () {
            const transactionId = document.getElementById("transactionId").value;
            const description = document.getElementById("description").value;
            const category_id = document.getElementById("category_id").value;
            const category_name = document.getElementById("category_name").value;
            const due_date = document.getElementById("due_date").value;
            const account_id = document.getElementById("account_id").value;
            const account_name = document.getElementById("account_name").value;
            const value = document.getElementById("value").value;

            fetch(`/transactions/${transactionId}/update/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
                },
                body: JSON.stringify({
                    description: description,
                    category_id: category_id,
                    account: account_id,
                    due_date: due_date,
                    value: value,
                })
            })
                .then(response => response.json())
                .then(data => {
                    alert("Transação atualizada com sucesso!");
                    location.reload();
                });
        });
    });
</script>

<style>
/* Estilos específicos para o modal de edição */
#ModalChange .modal-content {
    background: #1e293b;
    border: 1px solid #475569;
    color: #f1f5f9;
}

#ModalChange .modal-header {
    background: #334155;
    border-bottom: 1px solid #475569;
}

#ModalChange .modal-title {
    color: #f1f5f9 !important;
}

#ModalChange .btn-close {
    filter: brightness(0) invert(1);
}

#ModalChange .modal-body {
    background: #1e293b;
}

#ModalChange .form-control,
#ModalChange .form-select,
#ModalChange input,
#ModalChange select {
    background: #334155 !important;
    border: 1px solid #475569 !important;
    color: #f1f5f9 !important;
}

#ModalChange .form-control:focus,
#ModalChange .form-select:focus,
#ModalChange input:focus,
#ModalChange select:focus {
    background: #334155 !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
    color: #f1f5f9 !important;
    outline: none;
}

#ModalChange .form-control:disabled {
    background: #1e293b !important;
    color: #94a3b8 !important;
}

#ModalChange .form-label,
#ModalChange label {
    color: #f1f5f9 !important;
    font-weight: 500;
}

#ModalChange .btn-success {
    background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    border: none;
    font-weight: 600;
}

#ModalChange .btn-success:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(74, 222, 128, 0.4);
}

#ModalChange .btn-secondary {
    background: #334155;
    border: 1px solid #475569;
    color: #f1f5f9;
}

#ModalChange .btn-secondary:hover {
    background: #475569;
    color: #f1f5f9;
}
</style>